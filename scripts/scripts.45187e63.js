"use strict";angular.module("xke",["ngRoute","ui.select2"]).config(["$routeProvider","$httpProvider",function(a,b){b.defaults.headers.common={"X-Requested-With":"XMLHttpRequest",Accept:"application/json","Content-Type":"application/json"},a.when("/",{templateUrl:"views/slot/list.html",controller:"ListSlotCtrl"}).when("/new",{templateUrl:"views/slot/detail.html",controller:"CreateSlotCtrl"}).when("/edit/:slotId",{templateUrl:"views/slot/detail.html",controller:"EditSlotCtrl"}).when("/idea/new",{templateUrl:"views/idea/detail.html",controller:"CreateSlotCtrl"}).when("/idea/edit/:slotId",{templateUrl:"views/idea/detail.html",controller:"EditSlotCtrl"}).when("/users",{templateUrl:"views/users/list.html",controller:"ListUsersCtrl"}).when("/users/:userId",{templateUrl:"views/users/show.html",controller:"ShowUsersCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("xke").controller("ListUsersCtrl",["$scope","$http",function(a,b){b.get("/api/user").success(function(b){a.users=b})}]).controller("ShowUsersCtrl",["$scope","$http","$routeParams",function(a,b,c){b.get("/api/user/"+c.userId).success(function(b){a.userInfo=b})}]),angular.module("xke").config(["$httpProvider",function(a){a.interceptors.push([function(){return{request:function(a){return 0===a.url.indexOf("/api")&&(a.url="http://xke-test.xebiafr.eu.cloudbees.net"+a.url),a}}}])}]),angular.module("xke").controller("ListSlotCtrl",["$scope","$http","$location",function(a,b,c){a.slotsJustPlayed=[],a.xkeDate=new Date,b.get("/api/slots",{params:{type:"in_progress"}}).success(function(b){a.readySlots=b}),b.get("/api/slots",{params:{type:"idea"}}).success(function(b){a.ideas=b}),a.edit=function(a){console.log(JSON.stringify(a._id)),c.path("/edit/"+a._id)},a.takeIdea=function(c){var d=a.slots.ideas.indexOf(c);c.speakers.push(a.username),b.put("/api/slots/"+c.id,c).success(function(b){a.slots.ideas.splice(d,1),a.slots.readySlots.push(b)})},a.addOrRemoveSlotToPlayedArray=function(b){var c=a.slotsJustPlayed.indexOf(b);-1===c?a.slotsJustPlayed.push(b):a.slotsJustPlayed.splice(c,1)},a.playedAt=function(){a.slotsJustPlayed.forEach(function(c){c.playedDates.push(a.xkeDate),b.put("/api/slots/"+c.id,c)}),a.slotsJustPlayed=[],a.xkeDate=new Date}}]),angular.module("xke").controller("CreateSlotCtrl",["$scope","$location","$http","types","durations","fondations",function(a,b,c,d,e,f){a.saving=!1,a.types=d,a.durations=e,a.fondations=f,a.slot={type:d[0],fondation:f[0],duration:e[0],pitch:null},a.speakers=[{username:"test speaker"}],a.save=function(){a.slot.creator=a.username,a.slot.speakers||(a.slot.speakers=[]),a.slot.playedDates=[],a.saving=!0,c.post("/api/slots",a.slot).success(function(){a.saving=!1,b.path("/")}).error(function(){a.saving=!1})}}]),angular.module("xke").controller("EditSlotCtrl",["$scope","$location","$routeParams","$http","types","durations","fondations",function(a,b,c,d,e,f,g){var h=this;a.types=e,a.durations=f,a.fondations=g,a.slotId=c.slotId,d.get("/api/user").success(function(b){a.speakers=b}),d.get("/api/slots/"+c.slotId).success(function(b){a.slot=b}),a.isClean=function(){return angular.equals(h.original,a.slot)},a.destroy=function(){d.delete("/api/slots/"+c.slotId).success(function(){b.path("/")})},a.transformIntoIdea=function(){a.slot.speakers=[],d.put("/api/slots/"+a.slot.id,a.slot).success(function(){b.path("/")})},a.save=function(){a.slot.title=a.slot.title.replace(/"/g,'\\"'),d.put("/api/slots/"+a.slot.id,a.slot).success(function(){b.path("/")})}}]);